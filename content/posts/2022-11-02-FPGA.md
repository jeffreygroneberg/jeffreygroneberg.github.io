---
title: "FPGA - Und was daran so toll ist"
date: 2022-11-02T10:47:50+01:00
draft: false
---
## WARUM FPGA DIE BESTE EMULATION IST, OHNE EINE EMULATION ZU SEIN!

![Example image](/images/fpga.jpeg)

Sodele, das letzte Mal habe ich ein Video gepostet, bei dem ich gezeigt habe, wie man auf einem Analogue Pocket (https://www.analogue.co/pocket) jetzt SNES-Spiele spielen kann und war da mehr als hyped und einige User haben - ZURECHT - gefragt, was daran jetzt so besonders sei, da man doch schon sehr lange SNES auf etlichen Ger√§ten emulieren k√∂nne.  Dabei gab' es auch einige User, die mehr als interessiert waren, die Besonderheit dieses Ger√§tes zu verstehen und √ºberhaupt Teil der FPGA-Faszination zu werden. F√ºr eben diese und vielleicht auch anderen Interessierten hier ein paar Erkl√§rungen.  

## WAS IST FPGA?  

Grunds√§tzlich ist es mal so, dass FPGA (https://de.wikipedia.org/wiki/Field_Programmable_Gate_Array) eigentlich ein alter Hut ist und in der Industrie schon sehr viel l√§nger als in Consumer-Ger√§ten verwendet wird. Stellt euch vor, ihr h√§tte einen Chip, bei dem ihr jederzeit festlegen k√∂nnt, wie sich die Transistoren (oder besser die "Logik-Gatter" innerhalb des Chips verhalten sollen. Also eigentlich so eine Art T-1000 auf Chip-Ebene. So ein FPGA-Chip hat also die M√∂glichkeit, dass ein Entwickler ihm zum Zeitpunkt X eine Art Schaltbild mitteilt und ihm dann sagt "Wenn Strom bei dir anliegt an deinen verschiedenen Eing√§ngen, dann hast du gef√§lligst am Ende das folgende Ergebnis auszuspucken". Mal sehr simplifiziert. Das wird mit der sogenannten HDL gemacht (siehe Wikipedia https://de.wikipedia.org/wiki/Hardwarebeschreibungssprache). Ich kann mich also zB Daheim hinsetzen, kann mir so einen FPGA holen mit zB drei Eing√§ngen, kann hinter den Chip ein paar LEDs packen und kann jetzt vorm Start mittels HDL den Chip so einstellen, dass er f√ºr verschiedene Konfigurationen die LEDs an oder ausschaltet.  "H√§h? F√ºr was brauch ich da so einen Chip? Das kann ich doch mit normalen Schaltungen auch selbst l√∂ten!" Richtig. Aber jetzt kommt eben die Krux. Wenn ich Lust habe, dass die LEDs nach einem Tag jetzt anders geschaltet werden sollen, dann muss ich das nur in meiner HDL √§ndern, schnell auf den FPGA bringen und schwups habe ich da eine Art, die LEDs blinken zu lassen.  "Boah ey, toll, das kann ich mit einem Microcontroller auch." RICHTIG. Aber jetzt kommen wir zu den feinen Unterschieden. Der Microcontroller bekommt dieses Verhalten nicht auf der "Stromebene" sondern auf der "Software-Ebene". D.h. in einem Micro-Controller wird - nat√ºrlich da dann oft auf Maschinencode-Ebene - das Verhalten implementiert und wenn nun Strom an den Eing√§ngen anliegt, dann wird der Code ausgef√ºhrt und das erwartete Ergebnis dann an den Ausgang gepackt.  Ihr seht schon, dass wir in einem Microcontroller nun eigentlich schon eine Ebene mehr haben:  ‚Ä¢ 1. Strom liegt an  ‚Ä¢ 2. Dieser Strom wird interpretiert  ‚Ä¢ 3. Strom wird passenden an den Ausg√§ngen ausgegeben.  Bei einem FPGA-Chip passiert alles auf Strom-Ebene. Der Strom flie√üt also durch die "Gatter" und kommt dann passend am Ende wieder raus (Auch hier wieder mega simplifiziert zur Veranschaulichung).  

## SUPER? UND F√úR WAS BRAUCHT MAN JETZT DIESES FPGA?

  FPGAs werden seit Jahrzehnten in der Herstellung von Schaltungen und CPUs ben√∂tigt, um geplante Weiter- und Neuentwicklungen zu testen. Stellt euch vor, ihr seid ein super, dufter Intel-Ingenieur und w√ºrdet jetzt gerne die Funktionsweise eures neuen Super-Chips testen, ohne dass dieser hergestellt werden muss. Genau DAF√úR kann man FPGAs verwenden. FPGAs haben nat√ºrlich den Nachteil, dass diese Aufgrund ihrer Flexibilit√§t deutlich gr√∂√üer (komplizierter) herzustellen sind, als der Chip selbst am Ende und man hat es dann oft mit FPGA-ANLAGEN zu tun, die mehrere R√§ume/Racks umfassen. So wird dann der Schaltplan einer neuen CPU mit HDL beschrieben und dann werden die Millionen an FPGA-Logik-Gatter passend konfiguriert und der Plan des Chips (also der Entwurf) kann auf seine Funktionalit√§t getestet werden.  Das war so einer der ERSTEN Anwendungsf√§lle, f√ºr die die Teile eigentlich gebraucht wurden. Durch die Weiterentwicklung und dadurch, dass auch FPGAs leistungsf√§higer und kleiner wurden, werden FPGAs mittlerweile genutzt, um "Alt"-Systeme in Produktionen oder Ger√§ten los zu werden. Aber auch in Autos werden FPGAs gerne genutzt, da es f√ºr viele Anwendungsf√§lle einfach keine optimalen Chips gibt. In diesem Falle kann jemand einfach das FPGA so einstellen, dass es f√ºr gewisse Situationen optimal funktioniert (zB autonomes Fahren) etc. Da es in vielen Situationen in der Industrie oftmals keine Standards gibt, ist es f√ºr Hersteller einfach zu teuer, Chips herstellen zu lassen, die exakt den Anwendungsfall abdecken. Also stellt man sich die Chips dann einfach selbst mithilfe von FPGAs her. Das ist flexibler. Und zus√§tzlich ist man nicht auf mehrere Chip-Hersteller angewiesen und kann stattdessen in Gro√üen Margen von FPGA-Herstellern kaufen.  Aber auch in anderen Industriezweigen werden FPGAs gerne verwendet. Im Endeffekt immer dann, wenn auf Hardware-Ebene m√∂glichst ohne Latenz, mit maximaler Flexibilit√§t und f√ºr dedizierte F√§lle Chips gebraucht werden (zB DACs).  

## OK. UND WAS HAT DAS JETZT MIT KONSOLEN ZU TUN?  

Naja. Genauso, wie FPGAs IRGENDWELCHE Chips darstellen k√∂nnen, k√∂nnen die ja genauso auch Konsolen-Chips "emulieren". Emulieren ist hierbei nicht ganz richtig. Man muss eigentlich von simulieren sprechen, da sie in ihrer Funktion eben ein fast perfektes Ebenbild sind und den "Strom" perfekt nachbilden.  Eben diese F√§higkeit macht sich Analogue mit ihren Ger√§ten zu nutze. Gerade von GB(A)/NES/SNES gibt es mittlerweile durch die Jahrzehnte SEHR exaktes Reverse Engineering, was im Endeffekt die Chips einer jeder Konsolen auf "Schaltungsebene" beschreibt. Somit nimmt Analogue eben dieses Wissen und konfiguriert ihre FPGAs so, dass sich diese wie ihre Ebenbilder verhalten. Man HAT ALSO in den Analogue-Ger√§ten auf der Hardware-Ebene ein perfektes Ebenbild der Konsolen-Architektur, wie man sie auch in den Originalen wieder findet. Und der Witz ist, dass sich bei Konsolen nicht nur Chips in den Konsolen sondern auch in den Modulen wieder finden!  

## JO. SUPER. UND WAS IST DARAN JETZT BESSER ALS MIT SOFTWARE-EMULATION?  

Auch Heute gibt es immer noch Probleme mit Software-Emulation. Viele dieser Probleme haben mit Performance und mit Timings zu tun. Das meiste r√ºhrt daher, dass Software-Emulation eben NICHT auf der untersten Ebene des "Stromes" passiert, sondern es noch viele weitere Schichten gibt, die parallel zu einem Spiel ausgef√ºhrt und durchlaufen werden m√ºssen. Arbeitsspeicher - Programm - Betriebssystem - Maschinencode - Bus - CPU - (vielleicht wieder zur√ºck) - GPU - Anzeige.  Dazu kommt noch, dass in einer Konsole viele Komponenten parallel ihre Arbeit verrichten und die CPU der Konsole als zentrale Koordinationseinheit verwendet werden kann. Somit arbeiten pro "Tick", die eine CPU und die Komponenten machen k√∂nnen, eben Audio und GPU und auch der Chip im Modul parallel und liefern eben diese Ergebnisse dann auch parallel der CPU, dass diese damit was anfangen kann. In der Software-Emulation ist diese Orchestrierung VIEL schwieriger, da das Schedulung zuallererst beim Betriebssystem liegt und - obwohl man heutzutage auch viele Cores hat - man dennoch maximal an der Spielelogik dran bleiben muss, die 50/60hz auf die verwendete HZ-Zahl der CPU mapped.  DIESES Ged√∂ns hat man mit FPGA nicht üôÇ Innerhalb eines FPGAs k√∂nnen mehrere Konsolen-Chips gleichzeitig simuliert werden. Und das tolle ist, dass man einem FPGA sagen kann, dass es zB nur mit 1,7Mhz agieren solle.  Auch die Skalierung und die Ausgabe auf HDMI ist bei FPGA kein Problem - oder zumindest bei FPGA-Konsolen - da man eigentlich nur hinter den FPGA-Chip einen weiteren Chip klemmt, der das Bild passend dann ausgibt. Bei der Software-Emulation muss auch DAS zus√§tzlich von der Software innerhalb der Orchestrierung mit dem passenden Clock der Konsole getan werden.  Erbsenz√§hlerei nat√ºrlich. Aber f√ºr Enthusiasten macht das eben durchaus den Unterschied.  

## OK. KAPIERT. UND WAS WAR JETZT BEIM ANALOGUE POCKET SO GEIL, DASS DA EIN VIDEO POSTEST?  

Also. Der Analogue Pocket ist zuallererstmal ein GBC/GBA, der auf dem FPGA zur Laufzeit konfiguriert werden kann. Der Pocket sieht also aus wie ein umgebauter IPS v5 Gameboy verh√§lt sich aber EXAKT wie ein GBC oder eben ein GBA.  DAS WAR ER AM ANFANG!  Das Tolle am Analogue ist aber, dass der Analogue mit ZWEI FPGA-Chips auf den Markt kam und Analogue vor paar Wochen gesagt hat: "Ey, wisst ihr was? Wir √∂ffnen der Community den zweiten Chip und ihr k√∂nnt damit machen, was ihr wollt".  Und die Community hat nun sehr viele Konsolen schon auf eben diesen Chip geportet (https://www.reddit.com/.../analogue_pocket_openfpga.../). Und nochmal: Das Ger√§t verh√§lt sich also EXAKT so (zu 99% je nach Maturity des Cores - eine Konfiguration eines anderen Chips nennt man so) wie das Konsolen-Pendant. Ohne Lags. Ohne Performance-Hiccups. Ohne l√§stige Workaround. Und DAS ist eben das Geile hier. Mit den Cores kam nat√ºrlich - da es keine 100 Adapter gibt - auch die M√∂glichkeit, direkt die Spiele per Rom zu starten. Auch DAS ist kein Problem, da auf dem FPGA f√ºr die meisten Spiele noch platz f√ºr den zugeh√∂rigen Zusatzchip ist. √úbrigens verwendet Krikkz f√ºr seine Everdrive-Cardridges auch FPGA, um die ganzen Specialchips zu simulieren, da man ja mit dem Rom nicht mit liefern kann.  Somit bekommt man durch FPGA die Spiele-Logik und das Verhalten der Original-Konsolen, kann aber eben dann einfach HDMI nutzen, ohne da Murks mit Modding oder Retrotrink etc machen zu m√ºssen, die oftmals noch einen zus√§tzlichen Lag einbauen.  

## WOW. UND WIE KANN ICH JETZT MIT FPGA STARTEN?  

Leider ist in der Retro-Szene ein regelrechter Hype um FPGAs und deren Simulation entstanden und Analogue (https://www.analogue.co/) kann schlicht kaum nach liefern. Da hat sicherlich auch die derzeitige Chipsituation einen gro√üen Anteil dran und Analogue kalkuliert auch immer sehr d√ºnn. Analogue war aber da eigentlich auch nicht der "Vorreiter" sondern hat das Thema f√ºr den Mainstream tauglich und verk√§uflich gemacht. Es gibt eine sehr gro√üe Szene um den MisterFPGA. Im Endeffekt eine selbstgebaute Konsole auf Basis von FPGA und einer krassen Community, die eben sehr viele Addons und auch die Software liefert. Die meisten Cores, die derzeit auf den Analogue-Pocket geportet werden, haben als Basis die Mister-Cores.  Wenn ihr also UNBEDINGT in das FPGA-Business einsteigen wollt, dann kann ich euch raten, den Analogue Pocket auf der Page vor zu bestellen oder euch mit dem Thema "MisterFPGA" zu besch√§ftigen. Es gibt in Deutschland einen super Vertrieb: https://www.mister-fpga.de/sonstiges/mister-fpga-emu-2-0/ Aber auch https://ultimatemister.com/ ist super. Mit dem Mister FPGA k√∂nnt ihr auch eure Original-Controller nutzen.  SCHLUSSWORT  Ich hoffe, ich konnte euch jetzt ein wenig Klarheit verschaffen und die Konfusion ist etwas weg. Sicherlich ist FPGA mit einem hohen Preis verbunden, aber gerade f√ºr Enthusiasten und Puristen, die das alte mit dem neuen verbinden m√∂chten, die beste L√∂sung.  Ich bin mir zu 100% sicher, dass FPGA auch bei den gro√üen Herstellern in paar Jahren Einzug erhalten wird, um die Abw√§hrtskompatibilit√§t zu √§lteren Konsolen zu gew√§hrleisten, so wenn Software-Emulation nicht ausreicht.  W√ºnsch' Euch einen sch√∂nen Abend! 